---
title: "全基因组关联分析圈图"
author:
  - "**[编辑]** [苗奔奔](https://github.com/benben-miao)"
---

全基因组关联分析（GWAS）结果可视化主要包含按染色体位置展示SNP圈图、SNP密度图、显著性筛选的曼哈顿图、比较观测 p 值与期望 p 值的分布的QQ图等，用于筛选到全基因水平的候选变异基因。

## 示例

![](../images/Omics/GwasSnpPlot_demo.png){fig-alt="GwasSnpPlot DEMO" fig-align="center" width="60%"}

## 环境配置

-   系统要求： 跨平台（Linux/MacOS/Windows）

-   编程语言：R

-   依赖包：`CMplot`

```{r packages setup, message=FALSE, warning=FALSE, output=FALSE}
# 安装包
if (!requireNamespace("CMplot", quietly = TRUE)) {
  install.packages("CMplot")
}

# 加载包
library(CMplot)
```

```{r}
sessioninfo::session_info("attached")
```

## 数据准备

示例数据包含60K液相芯片Pig的原始变异信息数据。

```{r load data, message=FALSE, warning=FALSE}
# 示例数据
data(pig60K)
data <- pig60K

# 查看数据
head(data, 5)
```

## 可视化

### 1. SNP筛选基因组圈图

基因组圈图可以在相同占比下展示更多的染色体和性状，在多个性状比较时占极大优势。

```{r fig1GwasSnpCircos}
#| label: fig-1GwasSnpCircos
#| fig-cap: "SNP筛选基因组圈图"
#| out.width: "95%"
#| warning: false

# SNP筛选基因组圈图
p <- CMplot(
  data,
  type = "p",
  plot.type = "c",
  chr.labels = paste("Chr", c(1:18, "X", "Y"), sep = ""),
  r = 8,
  cir.axis = TRUE,
  outward = TRUE,
  cir.axis.col = "black",
  cir.chr.h = 2,
  chr.den.col = "black",
  file.output = FALSE,
  verbose = FALSE,
  mar = c(0,0,0,0)
)

p
```

### 2. SNP染色体密度图

SNP染色体密度图展示各个染色体上SNP密度分布。

```{r fig2GwasSnpDensity}
#| label: fig-2GwasSnpDensity
#| fig-cap: "SNP染色体密度图"
#| out.width: "95%"
#| warning: false
#| message: false

# SNP染色体密度图
p <- capture.output(
  CMplot(
    data,
    plot.type = "d",
    bin.size = 1e6,
    chr.den.col = c("darkgreen", "yellow", "red"),
    main = "Density",
    file.output = FALSE,
    verbose = FALSE
  )
)

print(p[1])
```

### 3. SNP筛选曼哈顿图

SNP筛选曼哈顿图便于展示5%或者1%的SNP显著性，同时也辅助鉴定关键染色体的集中效应。

```{r fig3GwasSnpManhattan}
#| label: fig-3GwasSnpManhattan
#| fig-cap: "SNP筛选曼哈顿图"
#| out.width: "95%"
#| warning: false
#| message: false

# SNP筛选曼哈顿图
p <- CMplot(
  data,
  type = "p",
  plot.type = "m",
  LOG10 = TRUE,
  threshold = NULL,
  file.output = FALSE,
  verbose = FALSE,
  chr.labels.angle = 45
)

p
```

### 4. SNP基于的QQ图

SNP基于的QQ图核心作用是检验 GWAS 分析中 SNP 的 P 值分布是否符合 “无关联假设下的期望分布”，以此判断分析结果的可靠性。

```{r fig4GwasSnpQQ}
#| label: fig-4GwasSnpQQ
#| fig-cap: "SNP基于的QQ图"
#| out.width: "95%"
#| warning: false
#| message: false

# SNP基于的QQ图
p <- CMplot(
  data,
  plot.type = "q",
  box = FALSE,
  conf.int = TRUE,
  conf.int.col = NULL,
  threshold.col = "red",
  threshold.lty = 2,
  file.output = FALSE,
  verbose = FALSE
)

p
```